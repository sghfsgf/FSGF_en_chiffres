<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>FSGF en chiffres - Tableau de bord</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>

<header class="topbar">
  <div class="logo">FSGF en chiffres</div>
  <nav class="menu">
    <a href="index.html">Accueil</a>
    <a href="statistiques.html">Statistiques</a>
    <a href="comparaisons.html">Comparaisons</a>
    <a href="admin.html">Admin</a>
  </nav>
</header>

<main>
  <h1>Tableau de bord - Vue générale</h1>

  <!-- Carte total étudiants année actuelle -->
  <section id="dashboard" style="display:flex; flex-wrap: wrap; gap: 20px;">
    <div class="card" style="flex:1; min-width:200px; padding:20px; background-color:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
      <h3>Total Étudiants (Année actuelle)</h3>
      <p id="totalEtudiants" style="font-size:2em; font-weight:bold;">0</p>
    </div>

    <div class="card" style="flex:1; min-width:200px; padding:20px; background-color:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
      <h3>Total par Département</h3>
      <ul id="totalDepartement"></ul>
    </div>

    <div class="card" style="flex:1; min-width:200px; padding:20px; background-color:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
      <h3>Total par Niveau</h3>
      <ul id="totalNiveau"></ul>
    </div>
  </section>
</main>

<footer>
  © 2026 FSGF en chiffres
</footer>

<script>
let statsData = [];

// Charger le fichier Excel
fetch('data/fsgf.xlsx')
  .then(res => res.arrayBuffer())
  .then(data => {
    const workbook = XLSX.read(data, { type: "array" });
    const sheet = workbook.Sheets["Donnees"];
    statsData = XLSX.utils.sheet_to_json(sheet);
    updateDashboard();
  });

// Mettre à jour le tableau de bord
function updateDashboard() {
  const currentYear = new Date().getFullYear();

  // Filtrer les données pour l'année actuelle
  const currentYearData = statsData.filter(d => Number(d.Année) === currentYear);

  // Total étudiants année actuelle
  const totalStudents = currentYearData.reduce((sum, d) => sum + Number(d.Effectifs), 0);
  document.getElementById("totalEtudiants").textContent = totalStudents;

  // Total par département
  const deptTotals = {};
  currentYearData.forEach(d => {
    if(!deptTotals[d.Département]) deptTotals[d.Département] = 0;
    deptTotals[d.Département] += Number(d.Effectifs);
  });
  const deptList = document.getElementById("totalDepartement");
  deptList.innerHTML = "";
  for(const dept in deptTotals){
    deptList.innerHTML += `<li>${dept}: ${deptTotals[dept]}</li>`;
  }

  // Total par niveau
  const niveauTotals = {};
  currentYearData.forEach(d => {
    if(!niveauTotals[d.Niveau]) niveauTotals[d.Niveau] = 0;
    niveauTotals[d.Niveau] += Number(d.Effectifs);
  });
  const niveauList = document.getElementById("totalNiveau");
  niveauList.innerHTML = "";
  for(const niveau in niveauTotals){
    niveauList.innerHTML += `<li>${niveau}: ${niveauTotals[niveau]}</li>`;
  }
}
</script>

</body>
</html>
